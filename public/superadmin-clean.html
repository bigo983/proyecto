<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Limpiando cach√©...</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            font-family: system-ui, -apple-system, sans-serif;
            color: white;
        }
        .loader {
            text-align: center;
        }
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        h1 { margin: 0 0 10px; font-size: 1.5rem; }
        p { margin: 0; opacity: 0.8; font-size: 0.9rem; }
    </style>
</head>
<body>
    <div class="loader">
        <div class="spinner"></div>
        <h1>üßπ Limpiando cach√©...</h1>
        <p>Redirigiendo al panel de SuperAdmin</p>
    </div>

    <script>
        (async function() {
            console.log('üßπ Iniciando limpieza completa...');

            // 1. Desregistrar TODOS los Service Workers
            if ('serviceWorker' in navigator) {
                const registrations = await navigator.serviceWorker.getRegistrations();
                for (let registration of registrations) {
                    const success = await registration.unregister();
                    console.log('‚úÖ Service Worker desregistrado:', success);
                }
            }

            // 2. Limpiar TODAS las cookies
            document.cookie.split(";").forEach(c => {
                const cookieName = c.split("=")[0].trim();
                document.cookie = cookieName + '=; Path=/; Expires=Thu, 01 Jan 1970 00:00:00 GMT; Domain=' + window.location.hostname;
                document.cookie = cookieName + '=; Path=/; Expires=Thu, 01 Jan 1970 00:00:00 GMT;';
            });
            console.log('‚úÖ Cookies limpiadas');

            // 3. Limpiar localStorage
            try {
                localStorage.clear();
                console.log('‚úÖ localStorage limpiado');
            } catch (e) {}

            // 4. Limpiar sessionStorage
            try {
                sessionStorage.clear();
                console.log('‚úÖ sessionStorage limpiado');
            } catch (e) {}

            // 5. Limpiar Cache Storage
            if ('caches' in window) {
                const cacheNames = await caches.keys();
                for (let name of cacheNames) {
                    await caches.delete(name);
                    console.log('‚úÖ Cache eliminado:', name);
                }
            }

            console.log('‚úÖ Limpieza completada');

            // 6. Redirigir con force reload
            setTimeout(() => {
                window.location.href = '/superadmin.html?' + Date.now();
                setTimeout(() => {
                    window.location.reload(true);
                }, 100);
            }, 1500);
        })();
    </script>
</body>
</html>
